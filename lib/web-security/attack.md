# HTTP安全

标签（空格分隔）： 前端知识体系

---

## HTTP缺点

### 窃听

通信使用明文，内容可能被窃听

* 可以通过网络嗅探器抓包相同段上的通信
* 互联网上的任何角落都存在通信内容被窃听的风险

### 伪装

不验证通信方身份，有可能遭遇伪装

* 任何人都可以发起请求
* 服务器只要接收到请求就会返回一个响应

### 篡改

无法证明报文的完整，有可能被篡改

* 发出的请求/响应中途可能遭攻击者拦截并篡改

## SSL/TSL

应用最广泛的网络安全技术，主流版本为SSL3.0和TSL1.0

* SSL（Secure Sockets Layer，安全套接字层）
* TLS（Transport Layer Security，传输层安全），SSL的升级版本

### 握手阶段

Client Hello, 客户端向服务器发起加密通信请求

* 支持的SSL版本
* 支持的Cipher Suite（加密算法及密钥长度）
* 第一个随机数

Server Hello, 服务器确认加密通信请求

* 确认使用的SSL版本
* 确认使用的Cipher Suite
* 第二个随机数
* 数字证书
* session ID用于session恢复

Client Key Exchange，客户端发送Pre-master secret

* 确认数字证书可信
* 生成第三个随机数Pre-master secret，并用证书中的公钥加密发送给服务器
* Change Cipher Spec
* 客户端握手结束通知

服务器解密随机数

* 使用私钥解密随机数
* Change Cipher Spec
* 服务器握手结束通知

### 通信阶段

* 客户端和服务器端根据约定的加密算法和三个随机数生成会话密钥
* 使用会话密钥解密接下来的通信过程

### session恢复

对话中断时恢复session

* session ID: 客户端发送服务器上一次发送的session ID，且服务器有这个编号的记录，则双方重新使用已有的会话密钥通信
* session Ticket: 客户端发送服务器上一次发送的session ticket，服务器解密session ticket得到会话密钥

## 数字证书

由CA（Certificate Authority，数字证书认证机构）颁发的二进制文件

### 分类

认证级别

* 域名认证：确认申请人拥有这个域名，地址栏会显示一把锁
* 公司认证：确认域名所有人是哪一家公司
* 扩展认证：最高级别的认证，地址栏会显示公司名

覆盖范围

* 单域名证书：只能用于单一域名
* 通配符证书：用于某个域名及其子域名
* 多域名证书：可以用于多个域名

### 构成

* 证书内容：证书颁发者、证书持有者、证书有效期、证书持有者公钥等信息
* 签名算法：使用签名算法计算证书内容并生成证书摘要
* 数字签名：证书颁发者使用自己的私钥对摘要进行加密，生成数字签名

### 证书链

* root: 根证书，由根认证机构自己给自己颁发的证书
* intermediates: 中间证书，由根证书或上一级中间证书机构颁发
* end-user: 末端使用者证书，由上一级中间证书机构颁发

### 验签

* 沿着证书链获得根证书，根据内置的受信任的根证书颁发机构列表确认根证书是否可信
* 使用根证书确认中间证书是否可信
* 使用中间证书确认末端使用者证书是否可信
 * 使用上一级证书的公钥解密数字签名，得到证书摘要
 * 对证书内容重新计算证书摘要，比较两个证书摘要，若相同，则证书可信

## HTTPS

HTTP Secure，超文本传输安全协议，披着SSL或TLS壳的HTTP

### 加密

公开密钥加密和对称密钥加密并用的混合加密机制

* 在交换密钥阶段使用公开密钥加密
* 在交换报文阶段使用对称密钥加密

### 认证

使用数字证书认证服务器、客户端身份

#### 服务器认证

* 客户端向服务器发送请求
* 服务器将自己的数字证书发送给客户端
* 客户端检验数字证书是否可信

#### 客户端认证

* 客户端向服务器发送请求
* 服务器要求客户端提供数字证书
* 客户端将自己的数字证书发送给服务器
* 服务器检验数字证书是否可信

### 完整性保护

使用MAC（Message Authentication Code）进行完整性确认

* 使用MD5或SHA算法计算发送的数据生成摘要
* 使用会话密钥对摘要进行加密，生成MAC
* 另一方使用会话密钥解密MAC，并重新生成摘要，比较两个摘要是否一致
